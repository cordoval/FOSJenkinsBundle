{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        <img alt="Jenkins" style="border-width: 0; vertical-align: middle; margin-right: 5px;" src="data:image/png;base64,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"/>
    {% endset %}
    {% set text %}

        {% if collector.isLastBuildSuccessful %}
            <span title="Build #{{ collector.lastBuild }} successful" style="color: #759e1a">successful</span>
        {% else %}
            <span title="Build #{{ collector.lastBuild }} failed" style="color: #a33">failed</span>
        {% endif %}
    {% endset %}
    {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
{% endblock %}

{% block menu %}
<span class="label">
    <span class="icon">
        <img src="{{ asset('bundles/fosjenkins/images/profiler/jenkins_menu.png') }}" alt="" />
    </span>
    <strong>Jenkins</strong>
    <span>
        &nbsp;<img style="vertical-align: bottom;" src="{{ asset('bundles/fosjenkins/images/icons/16x16/'~ collector.healthIcon) }}" alt="" />
    </span>
    <span class="count">
    {% if collector.failedTestsCount > 0 %}
        <span title="{{ collector.failedTestsCount }} tests failed" style="background-color: #a33">
            {{ collector.passedTestsCount }}/{{ collector.totalTestsCount }}
        </span>
    {% else %}
        <span title="All automated tests passed">
            {{ collector.passedTestsCount }}/{{ collector.totalTestsCount }}
        </span>
    {% endif %}

        <span{{ collector.failedTestsCount ? 'style="background-color: #a33"' : '' }}>
            {{ collector.passedTestsRate }}%
        </span>
    </span>
</span>
{% endblock %}

{% block panel %}

    {% block head %}
        {{ parent() }}
        <link href="{{ asset('bundles/fosjenkins/css/jenkins.css') }}" rel="stylesheet" type="text/css" media="screen" />
    {% endblock %}

    <h2>Builds History</h2>

    {% set panel_uri = path('_profiler', { 'token': token, 'panel': 'jenkins' }) %}

    <ul id="jenkins_menu">
        <li><a href="{{ panel_uri }}">Summary</a></li>
        <li><a href="{{ panel_uri }}&amp;subpanel=builds">Builds history</a></li>
        <li><a href="{{ panel_uri }}&amp;subpanel=commits">Commits logs</a></li>
        <li><a href="#">Unit tests</a></li>
        <li><a href="#">Code coverage</a></li>
        <li><a href="#">PMD</a></li>
        <li><a href="#">JDepend</a></li>
        <li><a href="#">PHPCDP</a></li>
        <li><a href="#">Violations</a></li>
    </ul>

    <style type="text/css">
        #jenkins_menu { margin-bottom: 25px }
        #jenkins_menu li { display: inline; margin: 5px }
    </style>

    {% set subpanel = app.request.query.get('subpanel') %}

    {% if 'builds' == subpanel %}
        {% render 'FOSJenkinsBundle:BuildAnalysis:buildHistory' with { 'collector': collector } %}
    {% elseif 'commits' == subpanel %}
        {% render 'FOSJenkinsBundle:BuildAnalysis:commitHistory' with { 'collector': collector } %}
    {% else %}
        {% include 'FOSJenkinsBundle:Panel:summary.html.twig' with { 'collector': collector } %}
    {% endif %}

    <h2>Actions</h2>

    <p>
        <ul>
            <li><a href="{{ collector.endpoint }}/build?delay=0">Launch a new build</a></li>
            <li><a href="{{ collector.endpoint }}/ws" target="_blank">See workspace</a></li>
        </ul>
    </p>

{% endblock %}
